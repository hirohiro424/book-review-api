{% extends 'base.html' %}
{% block content %}
<h2>âž• Add Book</h2>
<form id="create-form">
  <input name="title" placeholder="Title"><br>
  <input name="author" placeholder="Author ID"><br>
  <button type="submit">Create</button>
</form>

<script>
function getCSRFToken() {
  return document.cookie.split('; ')
    .find(row => row.startsWith('csrftoken='))
    ?.split('=')[1];
}

document.getElementById('create-form').onsubmit = function (e) {
  e.preventDefault();
  const form = e.target;
  fetch('/api/books/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCSRFToken()
    },
    body: JSON.stringify({
      title: form.title.value,
      author: form.author.value
    })
  }).then(() => window.location.href = "/web/books/");
};
</script>
{% endblock %}
