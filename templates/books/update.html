{% extends 'base.html' %}
{% block content %}
<h2>✏️ Edit Book</h2>
<form id="update-form">
  <input name="title" placeholder="Title"><br>
  <input name="author" placeholder="Author ID"><br>
  <button type="submit">Update</button>
</form>

<script>
function getCSRFToken() {
  return document.cookie.split('; ')
    .find(row => row.startsWith('csrftoken='))
    ?.split('=')[1];
}

const bookId = {{ book_id }};

fetch(`/api/books/${bookId}/`)
  .then(res => res.json())
  .then(book => {
    document.querySelector('[name="title"]').value = book.title;
    document.querySelector('[name="author"]').value = book.author;
  });

document.getElementById('update-form').onsubmit = function (e) {
  e.preventDefault();
  const form = e.target;
  fetch(`/api/books/${bookId}/`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCSRFToken()
    },
    body: JSON.stringify({
      title: form.title.value,
      author: form.author.value
    })
  }).then(() => window.location.href = "/web/books/");
};
</script>
{% endblock %}
